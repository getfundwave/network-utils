# Private Certificate Authority (CA) for SSH and SSL Certificates

This project provides a private Certificate Authority (CA) implementation for generating both SSH and SSL certificates. It allows you to issue certificates for SSH hosts and users, as well as client SSL certificates for secure communication.

## Installation


Deploy the resources by running:

   ```bash
   ./deploy-server-on-lambda.sh
   ```

This creates the following resources on AWS:
- Secret to store the keys for signing certificates
- A role for the lambda function
- A policy to be attached to the role giving read access to created secret
- An openSSH layer to facilitate SSH operations
- The lambda function to act as a privateCA

Note: Once the lambda is deployed you will need to manually add an environment variable called `AWS_SCRTS_REGION` to store the region in which AWS secrets for privateCA reside. 

## Usage

Certificates can be generated by running:

   ```bash
   cd client/Docker
   ./generate-certificate-curl.sh
   ```

You can pass the following params to modify the payload:

- `CA_ACTION`
  - generateHostSSHCert
  - generateClientSSHCert
  - generateClientX509Cert
- `CA_LAMBDA_URL`: The URL of the AWS Lambda function hosting the Private CA.
- `USER_SSH_DIR`: The path to the directory where the user's SSH keys will be stored. Defaults to "/home/$USER/.ssh".
- `SYSTEM_SSH_DIR`: The path to the system's SSH directory. Defaults to "/etc/ssh".
- `SYSTEM_SSL_DIR`: The path to the system's SSL directory. Defaults to "/etc/ssl".
- `AWS_STS_REGION`: The AWS region for the STS (Security Token Service). Defaults to "ap-south-1".
- `AWS_PROFILE`: The AWS profile for running aws commands. Defaults to "default"